<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>

    <title>  Backup completo de un guest Linux mediante tar
 | frommelmak</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content=""/>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.min.css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
    <link rel="stylesheet" href="https://frommelmak.com/theme/css/jquery.mglass.css"/>
    <link rel="stylesheet" href="https://frommelmak.com/theme/css/pygment-solarized-dark.css"/>
    <link rel="stylesheet" href="https://frommelmak.com/theme/css/style.css"/>

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href='//fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'/>
    <link href='//fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'/>
      <link href='//fonts.googleapis.com/css?family=Expletus+Sans' rel='stylesheet' type='text/css'>


    <link rel="icon" href="https://frommelmak.com/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://frommelmak.com/favicon.ico" type="image/x-icon">

    <!-- Feeds -->
      <link href="https://frommelmak.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="frommelmak Full Atom Feed"/>
      <link href="https://frommelmak.com/feeds/spanish.atom.xml" type="application/atom+xml" rel="alternate" title="frommelmak Categories Atom Feed"/>


  </head>

  <body>
    <div class="container">

      <header>
        <div class="page-header">
            <a href="https://frommelmak.com" class="avatar-container">
              <div class="avatar  animate ">
                <div class="side"><img src="images/avatar.png"/></div>
                  <div class="side back"><p class="text-center">Alien Life Form</p></div>
              </div>
            </a>
          <h1><a href="https://frommelmak.com">frommelmak</a> <small>Yet another Melmacian interested in technology...</small></h1>
        </div>

        <div class="navbar">
          <div class="navbar-inner">
            <a class="brand" href="https://frommelmak.com" title="Yet another Melmacian interested in technology...">frommelmak</a>
            <ul class="nav">
<li ><a href="/">Home</a></li>
<li ><a href="http://wiki.frommelmak.com">Wiki</a></li>
<li ><a href="http://old.frommelmak.com">Old Blog</a></li>
                  <li ><a href="https://frommelmak.com/pages/about.html">About</a></li>
            </ul>
              <form class="navbar-search pull-right" action="https://www.google.com" target="_blank">
                <input type="text" name="q" class="search-query span2" placeholder="Search"/>
                <i class="fa fa-search fa-fw"></i>
                <input type="hidden" name="cx" value="partner-pub-2082790787711438:7148578903" />
                <input type="hidden" name="ie" value="UTF-8" />
              </form>
          </div>
        </div>
      </header>

      <section>

        <div class="row">
          <div class=" span9  ">
  <h1>
    <a href="https://frommelmak.com/backup-completo-de-un-guest-linux-mediante-tar.html" rel="bookmark" title="Permalink to Backup completo de un guest Linux mediante tar">Backup completo de un guest Linux mediante&nbsp;tar</a>
  </h1>
          </div>
        </div>

        <div class="row">


          <div class=" span9 " id="content" role="main">
  

  <div>
    <p>Clonar una mquina virtual mediante <em>VMWare Converter</em> suele ser un proceso lento, especialmente si la máquina tiene un disco grande, este el espacio ocupado o no. En ocasiones, ya no es que sea lento, sino que directamente el <em>VMWare Converter</em> falla inexplicablemente. En estos caso tenemos dos opciones. O bien copiar el disco de la máquina mediante <span class="caps">SSH</span> (si tenemos acceso <code>ssh</code> al <em>ESXi</em>) o bien hacer un <em>tarball</em> de todo el sistema y extraerlo en una nueva&nbsp;máquina.</p>
<p>A continuacóin detallo los pasos para realizar este último&nbsp;procedimiento.</p>
<p>En primer lugar hay que crear el <code>tar.gz</code> de la máquina origen. Para ello, conectamos por <span class="caps">SSH</span> y nos aseguramos de que disponemos de espacio. Luego ejecutamos el comando que vuelca toda la raiz del sistema a un <em>tarball</em>:</p>
<div class="codehilite"><pre><span class="go">cd /</span>
<span class="go">tar cvlz --exclude=./tmp/* --exclude=./var/tmp/* --exclude=./proc/* --exclude=./sys/* --exclude=./mnt/* -f /var/tmp/guest_backup.tar.gz .</span>
</pre></div>


<p>En primer lugar necesitamos una <span class="caps">ISO</span> bootable de un sistema Linux con las herramientas necesarias para hacer la extracción y restauración del <em>tarball</em>. Una buena distro para estos menesteres es <span class="caps">RIP</span>&nbsp;Linux.</p>
<p><a href="http://rip.7bf.de/current/RIPLinux-9.3-non-X.iso"><span class="caps">RIP</span> Linux&nbsp;Image</a></p>
<p>Copiaremos esta <span class="caps">ISO</span> al datastore del ESXi de&nbsp;destino.</p>
<p>Ahora creamos una máquina en el ESXi de destino con un disco de igual tamao al que queremos copiar y configuraremos esta máquina para que arranque con la <span class="caps">ISO</span> de <span class="caps">RIP</span>&nbsp;Linux.</p>
<p>Particionamos el disco <code>sda</code> de la máquina y lo&nbsp;formateamos.</p>
<div class="codehilite"><pre><span class="go">fdisk /dev/sda</span>
<span class="go">mkfs.ext3 /dev/sda1</span>
<span class="go">mkswap /dev/sda2</span>
<span class="go">mount /dev/sda1 /mnt/sda1</span>
</pre></div>


<p>Nos asignamos una <span class="caps">IP</span> y copiamos el <code>tar.gz</code> a la via <code>scp</code> y extraemos el <em>tarball</em>.</p>
<div class="codehilite"><pre><span class="go">ifconfig eth0 x.x.x.x</span>
<span class="go">cd /mnt/sda1</span>
<span class="go">scp user@host:/guest_backup.tar.gz .</span>
<span class="go">tar zxvf guest_backup.tar.gz</span>
<span class="go">chroot /mnt/sda1</span>
<span class="go">grub-mkconfig /boot/grub/grub.cfg</span>
<span class="go">grub-install /dev/sda</span>
</pre></div>


<p>Ahora ya podemos reiniciar el&nbsp;equipo.</p>
<p>Si teniamos <em>mysql</em> corriendo, deberemos restablecer el owner de los siguientes directorios, ya que el <span class="caps">UID</span> de mysql en diferente en Debian al de <span class="caps">RIP</span>&nbsp;Linux.</p>
<div class="codehilite"><pre><span class="go">chown -R mysql /var/run/mysqld</span>
<span class="go">chown -R mysql /var/log/mysql</span>
<span class="go">chown -R mysql /var/log/mysql.*</span>
<span class="go">chown -R mysql.mysql /var/lib/mysql</span>
</pre></div>


<p>Es posible que tengamos que repetir el mismo procedimiento si utilizabamos servicios que corran bajo un usuario cuyo <span class="caps">UID</span> difiera del que utiliza <span class="caps">RIP</span>&nbsp;Linux.</p>
<p>Finalmente, si nuestro <code>fstab</code> hacia referencia a UUIDs en lugar de a devices, lo mejor es modificarlo y asegurarnos que utiliza los devices que&nbsp;toca.</p>
  </div>


    <div class="comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'frommelmak';
        var disqus_identifier = "backup-completo-de-un-guest-linux-mediante-tar.html";
        var disqus_title = "Backup completo de un guest Linux mediante tar";
        var disqus_url = "https://frommelmak.com/backup-completo-de-un-guest-linux-mediante-tar.html";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus</a>.</noscript>
    </div>

          </div>

            <div class="span3">
  <div class="well">

    <p><abbr class="fa fa-calendar" title="2010-05-03T17:25:39"> Mon 03 May 2010</abbr></p>

      <p><address class="fa fa-user"> By <a href="https://frommelmak.com/author/frommelmak.html" rel="author">frommelmak</a></address></p>

    <hr/>

      <p>
              <a href="https://frommelmak.com/category/spanish.html" rel="tag tooltip" class="label label-info" data-placement="right" data-original-title="56 articles in this category">Spanish</a>
            <a href="/tag/backup.html" rel="tooltip" class="label" data-placement="right" data-original-title="1 article with this tag">backup</a>
            <a href="/tag/tar.html" rel="tooltip" class="label" data-placement="right" data-original-title="1 article with this tag">tar</a>
      </p>
      <hr/>

      <p>Found a typo ? Want to fix it ?</p>
      <a class="btn btn-info btn-block" href="https://github.com/frommelmak/blog/edit/master/content/posts/backup-completo-de-un-guest-linux-mediante-tar.md"><i class="fa fa-random fa-white fa-fw"></i> Edit article on GitHub</a>
      <hr/>

      <ul class="pager">
        <li class="previous "><a  href="https://frommelmak.com/anadir-discos-en-caliente-a-guest-debian-50-sobre-esxi-host.html" title="Añadir discos en caliente a guest Debian 5.0 sobre ESXi host"  rel="prev">← Older</a></li>
        <li class="next "><a  href="https://frommelmak.com/esxi-snapshots-en-otro-datastore.html" title="ESXi: Snapshots en otro datastore"  rel="next">Newer →</a></li>
      </ul>

  </div>
              
            </div>

        </div>
      </section>

    </div>

    <!-- TODO: make footer sticky -->
    <footer class="container-fluid">
      <div class="container">
        <div class="row">

            <div class="span2">
                <h5>Social</h5>
                <ul class="unstyled">
                  <li>  <a href="http://twitter.com/frommelmak">
      <i class="fa fa-twitter"></i>
    @frommelmak
  </a></li>
                </ul>
            </div>
            <div class="span2">
                <h5>Links</h5>
                <ul class="unstyled">
                  <li>  <a href="http://linkedin.com/in/marcosmartinezjimenez">
      <i class="fa fa-linkedin-square"></i>
    LinkedIn
  </a></li>
                  <li>  <a href="http://github.com/frommelmak">
      <i class="fa fa-github"></i>
    GitHub
  </a></li>
                  <li>  <a href="http://www.youtube.com/user/melmak">
      <img src="https://icons.better-idea.org/icon?url=www.youtube.com&size=16" width="16" height="16" class="icon" alt="www.youtube.com icon"/>
    Youtube
  </a></li>
                </ul>
            </div>

          <div class="span2">
            <h5>Browse content by</h5>
            <ul class="fa-ul">
                <li><a href="https://frommelmak.com/categories/index.html"><i class="fa-li fa fa-tags"></i> Categories</a></li>
                <li><a href="https://frommelmak.com/archives/index.html"><i class="fa-li fa fa-calendar"></i> Dates</a></li>
                <li><a href="https://frommelmak.com/tags/index.html"><i class="fa-li fa fa-tag"></i> Tags</a></li>

                <li><a href="https://frommelmak.com/feeds/spanish.atom.xml"><i class="fa-li fa fa-rss"></i> Feed</a></li>
            </ul>
          </div>

          <div class="span2 muted">
            <h5>Copyright notice</h5>
            <p>© Copyright 2005-2015 Marcos Martínez.</p>
          </div>

          <div class="span2 muted">
            <h5>Disclaimer</h5>
              <p>All opinions expressed in this site are my own personal opinions and are not endorsed by, nor do they represent the opinions of my previous, current and future employers or any of its affiliates, partners or customers.</p>
          </div>

          <div class="span2">
            <h5 class="pull-right"><a href="#" class="fa fa-arrow-up"> Back to top</a></h5>
          </div>

        </div>
      </div>

      <div class="container">
        <div class="row span12 muted text-center">
          Site generated by <a href="http://getpelican.com"> Pelican</a>.<br/>
          <a href="https://github.com/kdeldycke/plumage"> Plumage</a> theme by <a href="http://kevin.deldycke.com">Kevin Deldycke</a>.
        </div>
      </div>

    </footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="https://frommelmak.com/theme/js/jquery.mglass.js"></script>
    <script src="https://frommelmak.com/theme/js/application.js"></script>

  </body>
</html>