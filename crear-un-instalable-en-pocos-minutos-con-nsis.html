<!DOCTYPE html>
<html lang="es">
<head>
          <title>frommelmak - Crear un instalable en pocos minutos con <span class="caps">NSIS</span></title>
        <meta charset="utf-8" />




    <meta name="tags" content="nsis" />
    <meta name="tags" content="installer" />
    <meta name="tags" content="win32" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://frommelmak.com/">frommelmak <strong>Yet another Melmacian interested in technology...</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/">Home</a></li>
            <li><a href="https://frommelmak.com/pages/about.html">About</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://frommelmak.com/crear-un-instalable-en-pocos-minutos-con-nsis.html" rel="bookmark"
         title="Permalink to Crear un instalable en pocos minutos con NSIS">Crear un instalable en pocos minutos con <span class="caps">NSIS</span></a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2008-12-19T00:54:42+01:00">
      Fri 19 December 2008
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://frommelmak.com/author/frommelmak.html">frommelmak</a>
    </address>
    <div class="category">
        Category: <a href="https://frommelmak.com/category/spanish.html">Spanish</a>
    </div>
    <div class="tags">
        Tags:
            <a href="https://frommelmak.com/tag/nsis.html">nsis</a>
            <a href="https://frommelmak.com/tag/installer.html">installer</a>
            <a href="https://frommelmak.com/tag/win32.html">win32</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><a href="http://nsis.sourceforge.net/"><span class="caps">NSIS</span></a> (<em>Nullsoft Scriptable Install System</em>) permite empaquetar aplicaciones en un fichero <code>.exe</code> autoinstalable. Aplicaciones como <a href="http://www.openvpn.se/download.html">OpenVPN</a> (para Windows) o <a href="http://www.videolan.org/"><span class="caps">VLC</span></a> lo utilizan para distribuir sus versiones para plataformas&nbsp;Win32.</p>
<p>Pese a que la aplicación esta ampliamente <a href="http://nsis.sourceforge.net/Docs/">documentada</a>, he querido escribir este mini-articulo, en el que mediante un ejemplo explico los pasos a seguir para distribuir una aplicación. La idea es que dicho ejemplo sirva de base para no tener que perder mucho tiempo leyendo documentación y realizando mil y una pruebas antes de poder generar un instalable. Podeis utilizar el ejemplo como punto de partida para luego añadir lo que se os ocurra. Para ello os recomiendo dar un vistazo al <a href="http://nsis.sourceforge.net/Developer_Center">rincón de desarrolladores</a> de la wiki del proyecto <span class="caps">NSIS</span>.</p>
<p>Para crear un instalable <code>.exe</code> con <span class="caps">NSIS</span> lo único que necesitamos es instalar la aplicación <span class="caps">NSIS</span> y crear un fichero de texto con extensión <code>.nsi</code>. Este fichero define -mediante un lenguaje de script propio- cómo ha de ser el instalable: apariencia, ficheros a instalar, directorio de instalación , selección de idioma, comprobaciones a realizar, modificar o leer el registro de Windows, descargar e instalar dependencias, acciones a realizar para la desinstalación. En definitiva, casi cualquier cosa que se nos pueda pasar por la&nbsp;cabeza.</p>
<p>Una vez tengamos nuestro fichero <code>.nsi</code>, crear el instalable es tan fácil como seleccionar nuestro fichero y desplegar el menu contextual. Tras seleccionarar la opción Compile <span class="caps">NSIS</span> Scirpt, aparecerá una consola con información acerca del progreso de generación del ejecutable, o en caso de error informacin relativa al&nbsp;fallo.</p>
<p>Pese a que <span class="caps">NSIS</span> permite personalizar el aspecto del instalador incrustando una imagen mediante las instrucciones <code>AddBrandingImage</code> y <code>SetBrandingImage</code>, es posible extender estas capacidades utilizando <a href="http://nsis.sourceforge.net/Docs/Modern%20UI%202/Readme.html"><span class="caps">NSIS</span> Modern User Interface</a> o <a href="http://ultramodernui.sourceforge.net/">Ultra Modern User Inteface</a>.</p>
<p>El ejemplo que sigue a continuación utiliza Modern <span class="caps">UI</span> para crear un instalador resultón en un momento. Pare ser honestos, he de reconocer que pese a la fántastica documentación de <span class="caps">NSIS</span>, he perdio un buen rato intentando mejoar el look and feel del instalable mediante Modern <span class="caps">UI</span> debido a un problema que no he encontrado descrito en ningun sitio. El problema es que las imagenes de la cabecera no se muestran si no se incluye la instrucción <code>!insertmacro MUI_LANGUAGE lang</code>, que a priori no tiene nada que&nbsp;ver.</p>
<p>El ejemplo esta cargado de comentarios por lo que será fácil adaptarlo a vuestras necesidades. Para entenderlo simplemente hay que saber que el fichero <code>.nsi</code> esta ubicado en el mismo directorio que contiene los ficheros que conforman la aplicación que queremos instalar, así como las imagenes que utilizaremos para el wizard de&nbsp;instalación.</p>
<div class="highlight"><pre><span></span><span class="go"> --FooApp</span>
<span class="go">     |    `--lib</span>
<span class="go">     |     |--file1.dll</span>
<span class="go">     |     `--fileN.dll</span>
<span class="go">     |-- header.bmp</span>
<span class="go">     |-- image1.bmp</span>
<span class="go">     |-- foo_app.ico</span>
<span class="go">     |-- start_foo.exe </span>
<span class="go">     |-- foo_app.nsi</span>
<span class="go">     `-- README.txt</span>
</pre></div>


<p>El fichero <code>foo_app.nsi</code> encargado de crear el instalable para esta aplicacin podria ser&nbsp;este:</p>
<div class="highlight"><pre><span></span><span class="c">;----------------------------------------------------------------------------</span>
<span class="c">; General configuration</span>

<span class="c">; The name and version of the installer</span>

 <span class="cp">!define</span> VERSION 1.0
 <span class="k">Name</span> Foo App <span class="kp">${VERSION}</span>
 <span class="k">OutFile</span> Foo App Installer <span class="o">-</span> <span class="kp">${VERSION}</span>.exe
 <span class="k">InstallDir</span> <span class="nv">$PROGRAMFILES</span><span class="p">\</span>Foo App

 <span class="c">;;; Request application privileges for Windows Vista (can be user or admin)</span>
 <span class="k">RequestExecutionLevel</span> <span class="no">admin</span>
<span class="c">;----------------------------------------------------------------------------</span>


<span class="c">;--------------------------------</span>
<span class="c">;Use Modern User Interface</span>
 <span class="cp">!include</span> MUI2.nsh
<span class="c">;--------------------------------</span>


<span class="c">;--------------------------------</span>
<span class="c">; Interface Settings</span>

 <span class="k">BrandingText</span> Foo App Installer (Powered by NSIS)
 <span class="cp">!define</span> MUI_HEADERIMAGE
 <span class="cp">!define</span> MUI_HEADERIMAGE_BITMAP header.bmp <span class="c">; size 150x57</span>
 <span class="cp">!define</span> MUI_HEADERIMAGE_UNBITMAP header.bmp <span class="c">; size 150x57</span>
 <span class="cp">!define</span> MUI_PAGE_HEADER_TEXT Installing Foo App
 <span class="cp">!define</span> MUI_PAGE_HEADER_SUBTEXT Copying files...
 <span class="cp">!define</span> MUI_ABORTWARNING
 <span class="cp">!define</span> MUI_ICON foo_app.ico
 <span class="cp">!define</span> MUI_UNICON foo_app.ico

<span class="c">; Pages</span>

 <span class="cp">!define</span> MUI_WELCOMEFINISHPAGE_BITMAP image1.bmp <span class="c">; size 164x314</span>
 <span class="cp">!define</span> MUI_WELCOMEPAGE_TITLE_3LINES
 <span class="cp">!define</span> MUI_WELCOMEPAGE_TITLE Welcome to the Foo App <span class="kp">${VERSION}</span> $<span class="p">\</span>n Setup Wizard
 <span class="cp">!define</span> MUI_WELCOMEPAGE_TEXT This wizard will guide you through the installation of <span class="p">\</span>
 Foo App <span class="kp">${VERSION}</span> $<span class="p">\</span>n$<span class="p">\</span>nClick Install to continue

 <span class="cp">!define</span> MUI_INSTFILESPAGE_FINISHHEADER_TEXT Foo App Setup Complete
 <span class="cp">!define</span> MUI_INSTFILESPAGE_COLORS f1f1f1 000000
 <span class="cp">!define</span> MUI_FINISHPAGE_NOAUTOCLOSE

 <span class="cp">!define</span> MUI_FINISHPAGE_TITLE Setup Complete
 <span class="cp">!define</span> MUI_FINISHPAGE_TEXT Thank you for using Foo App
 <span class="cp">!define</span> MUI_FINISHPAGE_RUN foo.exe
 <span class="cp">!define</span> MUI_FINISHPAGE_RUN_TEXT Start Foo App

 <span class="cp">!define</span> MUI_UNCONFIRMPAGE_TEXT_TOP Remove Foo App from this computer
 <span class="cp">!define</span> MUI_UNCONFIRMPAGE_TEXT_LOCATION Installation <span class="nl">Directory</span><span class="p">:</span>

 <span class="cp">!insertmacro</span> MUI_PAGE_WELCOME
 <span class="cp">!insertmacro</span> MUI_PAGE_INSTFILES
 <span class="cp">!insertmacro</span> MUI_PAGE_FINISH

 <span class="cp">!insertmacro</span> MUI_UNPAGE_CONFIRM
 <span class="cp">!insertmacro</span> MUI_UNPAGE_INSTFILES

 <span class="k">ShowInstDetails</span> <span class="no">show</span>
 <span class="k">ShowUninstDetails</span> <span class="no">show</span>
<span class="c">;---------------------------------------------</span>

<span class="c">;---------------------------------------------</span>
<span class="c">; I don&#39;t know why but required to show images</span>

 <span class="cp">!insertmacro</span> MUI_LANGUAGE English
<span class="c">;---------------------------------------------</span>

<span class="c">;--------------------------------</span>
<span class="c">; The stuff to install</span>
<span class="k">Section</span> Install
 <span class="c">;;; Foo App will be installed for all users</span>
 <span class="k">SetShellVarContext</span> <span class="no">all</span>
 <span class="c">;;; Set output path to the installation directory.</span>
 <span class="k">SetOutPath</span> <span class="vg">$INSTDIR</span>
 <span class="c">;;; Put *.exe file there</span>
 <span class="k">File</span> start_foo.exe
 <span class="k">File</span> README.txt
 <span class="k">File</span> foo_app.ico
 <span class="k">File</span> image1.bmp
 <span class="k">File</span> header.bmp
 <span class="k">SetOutPath</span> <span class="vg">$INSTDIR</span><span class="p">\</span>lib
 <span class="k">File</span> lib<span class="p">\</span>*.dll
 <span class="k">WriteUninstaller</span> <span class="vg">$INSTDIR</span><span class="p">\</span>uninstaller.exe
 <span class="k">SetOutPath</span> <span class="vg">$INSTDIR</span>
 <span class="c">;;; Create desktop shortcut</span>
 <span class="k">CreateShortCut</span> <span class="nb">$DESKTOP</span><span class="p">\</span>Foo App.lnk <span class="vg">$INSTDIR</span><span class="p">\</span>start_foo.exe  <span class="vg">$INSTDIR</span><span class="p">\</span>foo_app.ico
 <span class="c">;;; Create start-menu items</span>
 <span class="k">CreateDirectory</span> <span class="nb">$STARTMENU</span><span class="p">\</span>Foo App
 <span class="k">CreateShortCut</span> <span class="nb">$STARTMENU</span><span class="p">\</span>Foo App<span class="p">\</span>Foo App.lnk <span class="vg">$INSTDIR</span><span class="p">\</span>start_foo.exe  <span class="vg">$INSTDIR</span><span class="p">\</span>foo_app.ico
 <span class="k">CreateShortCut</span> <span class="nb">$STARTMENU</span><span class="p">\</span>Foo App<span class="p">\</span>Foo App Uninstaller.lnk <span class="vg">$INSTDIR</span><span class="p">\</span>uninstaller.exe
 <span class="c">;;; Add uninstall information to Add/Remove Programs (Control Panel)</span>
 <span class="k">WriteRegStr</span> <span class="no">HKLM</span> Software<span class="p">\</span>Microsoft<span class="p">\</span>Windows<span class="p">\</span>CurrentVersion<span class="p">\</span>Uninstall<span class="p">\</span>FooApp <span class="p">\</span>
 DisplayName Foo App Bla Bla
 <span class="k">WriteRegStr</span> <span class="no">HKLM</span> Software<span class="p">\</span>Microsoft<span class="p">\</span>Windows<span class="p">\</span>CurrentVersion<span class="p">\</span>Uninstall<span class="p">\</span>FooApp <span class="p">\</span>
 UninstallString <span class="vg">$INSTDIR</span><span class="p">\</span>uninstaller.exe
 <span class="k">WriteRegStr</span> <span class="no">HKLM</span> Software<span class="p">\</span>Microsoft<span class="p">\</span>Windows<span class="p">\</span>CurrentVersion<span class="p">\</span>Uninstall<span class="p">\</span>FooApp <span class="p">\</span>
 DisplayIcon <span class="vg">$INSTDIR</span><span class="p">\</span>foo_app.ico
 <span class="k">WriteRegStr</span> <span class="no">HKLM</span> Software<span class="p">\</span>Microsoft<span class="p">\</span>Windows<span class="p">\</span>CurrentVersion<span class="p">\</span>Uninstall<span class="p">\</span>FooApp <span class="p">\</span>
 Publisher Your Organization
<span class="k">SectionEnd</span>
<span class="c">;--------------------------------</span>

<span class="c">;--------------------------------</span>
<span class="c">; The stuff to Uninstall</span>
<span class="k">Section</span> Uninstall
 <span class="c">;;; Foo App will be removed for all users</span>
 <span class="k">SetShellVarContext</span> <span class="no">all</span>
 <span class="k">SetOutPath</span> <span class="vg">$INSTDIR</span>
 <span class="k">RMDir</span> <span class="na">/r</span> <span class="vg">$INSTDIR</span>
 <span class="k">RMDir</span> <span class="na">/r</span> <span class="nb">$STARTMENU</span><span class="p">\</span>Foo App
 <span class="k">Delete</span> <span class="nb">$DESKTOP</span><span class="p">\</span>Foo App.lnk
 <span class="c">;;; Remove Foo App info from the windows registry</span>
 <span class="k">DeleteRegKey</span> <span class="no">HKLM</span> Software<span class="p">\</span>Microsoft<span class="p">\</span>Windows<span class="p">\</span>CurrentVersion<span class="p">\</span>Uninstall<span class="p">\</span>FooApp
<span class="k">SectionEnd</span>
<span class="c">;--------------------------------</span>
</pre></div>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>