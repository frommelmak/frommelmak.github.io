<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>  lsof: Practical usage examples
 | frommelmak</title>

    <meta name="author" content="Marcos Martinez"/>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
    <link rel="stylesheet" href="https://frommelmak.com/theme/css/jquery.mglass.css"/>
    <link rel="stylesheet" href="https://frommelmak.com/theme/css/pygment-solarized-dark.css"/>
    <link rel="stylesheet" href="https://frommelmak.com/theme/css/style.css"/>

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=Expletus+Sans' rel='stylesheet' type='text/css'>


    <link rel="icon" href="https://frommelmak.com/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://frommelmak.com/favicon.ico" type="image/x-icon">

    <!-- Feeds -->


  </head>

  <body>

    <div class="container">

      <div class="page-header">
          <a href="https://frommelmak.com" class="avatar-container pull-left">
            <div class="avatar  animate ">
              <div class="side"><img src="images/avatar.png" class="img-responsive"/></div>
                <div class="side back"><p class="text-center">Alien Life Form</p></div>
            </div>
          </a>
        <h1><a href="https://frommelmak.com">frommelmak</a> <small>Yet another Melmacian interested in technology...</small></h1>
      </div>

      <nav class="navbar navbar-default">

        <!-- Hamburger menu for mobile -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://frommelmak.com" title="Yet another Melmacian interested in technology...">frommelmak</a>
        </div>

        <!-- Menus and search forms -->
        <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

          <ul class="nav navbar-nav">
<li >
                <a href="/">Home</a>
              </li>
<li >
                  <a href="https://frommelmak.com/pages/about.html">About</a>
                </li>
          </ul>

            <form class="navbar-form navbar-right" role="search" action="https://www.google.com" target="_blank">
              <div class="form-group">
                <div class="input-group">
                  <input type="text" name="q" class="form-control search-query" placeholder="Search" required />
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="button"><i class="fa fa-search fa-fw"></i></button>
                  </span>
                </div>
                <input type="hidden" name="cx" value="partner-pub-2082790787711438:7148578903" />
                <input type="hidden" name="ie" value="UTF-8" />
              </div>
            </form>


        </div>

      </nav>

    </div>


    <div class="container main">


      <div class="row">
        <div class=" col-md-9  ">
  <h1>
    <a href="https://frommelmak.com/lsof-practical-usage-examples.html" rel="bookmark" title="Permalink to lsof: Practical usage examples">lsof: Practical usage&nbsp;examples</a>
  </h1>
        </div>
      </div>

      <div class="row">


        <div class=" col-md-9 " id="content" role="main">
  

  <div>
    <p>As you probably know, <code>lsof</code> stands for List of Open Files. Yes, it&#8217;s seems a simple description for a simple Unix command but, wait! Have you ever heard that everything in Unix is a file? Yes, right? So maybe this tool is more powerful than you&nbsp;think.</p>
<p>Let me show you how powerful it is with a bunch of practical examples (use&nbsp;root):</p>
<p>Lists all open files belonging to all active&nbsp;processes.</p>
<div class="highlight"><pre><span></span>lsof
</pre></div>


<p>Shows all files opened by the <code>www-data</code> user </p>
<div class="highlight"><pre><span></span>lsof -u www-data
</pre></div>


<p>Lists just all the PIDs of the processes opened by the <code>www-data</code> user</p>
<div class="highlight"><pre><span></span>lsof -t -u www-data
</pre></div>


<p>Kills all the activity for a particular&nbsp;user</p>
<div class="highlight"><pre><span></span>killall -9 <span class="sb">`</span>lsof -t -u username<span class="sb">`</span>
</pre></div>


<p>Lists all the files opened by the process with the <code>PID</code> 234</p>
<div class="highlight"><pre><span></span>lsof -p <span class="m">234</span>
</pre></div>


<p>Lists processes which are using a specific&nbsp;file.</p>
<div class="highlight"><pre><span></span>lsof -t /var/log/auth.log
</pre></div>


<p>Lists all the log files in&nbsp;use.</p>
<div class="highlight"><pre><span></span>lsof +D /var/log
</pre></div>


<p>Lists all the opened files in a <span class="caps">NFS</span>&nbsp;folder</p>
<div class="highlight"><pre><span></span>lsof +D -N /mnt/nfsstorage
</pre></div>


<p>Lists of the files opened by the processes whose command begins with the characters of&nbsp;&#8220;chrome&#8221;.</p>
<div class="highlight"><pre><span></span>lsof -c chrome
</pre></div>


<p>Until here we were focused on regular files. But, what if we start listing special files like network files&nbsp;?</p>
<p>Lists all network connections (Yes! Because everything in Unix is a&nbsp;file)</p>
<div class="highlight"><pre><span></span>lsof -i
</pre></div>


<p>Lists all network connections on port&nbsp;80</p>
<div class="highlight"><pre><span></span>lsof -i:80
</pre></div>


<p>Lists of all network connections on privileged&nbsp;ports,</p>
<div class="highlight"><pre><span></span>lsof -i:1-1024
</pre></div>


<p>Lists all IPv4 connections on the&nbsp;system</p>
<div class="highlight"><pre><span></span>lsof -i4
</pre></div>


<p>See localhost&nbsp;connections.</p>
<div class="highlight"><pre><span></span>lsof -i <span class="m">4</span>@127.0.0.1
</pre></div>


<p>Shows all listening <span class="caps">TCP</span>/<span class="caps">UDP</span>&nbsp;ports</p>
<div class="highlight"><pre><span></span>lsof -Pan -i tcp -i udp
</pre></div>


<p>Shows all connections on port 80 using a <span class="caps">TCP</span>&nbsp;socket.</p>
<div class="highlight"><pre><span></span>lsof -i TCP:80
</pre></div>


<p>Shows al <span class="caps">TCP</span> sockets listening on the&nbsp;system.</p>
<div class="highlight"><pre><span></span>lsof -i -sTCP:LISTEN
</pre></div>


<p>Shows all listening or established connection <span class="caps">TCP</span> ipv4&nbsp;sockets.</p>
<div class="highlight"><pre><span></span>lsof -s TCP:ESTABLISHED,LISTEN -i4TCP
</pre></div>


<p>Check what services are still using old removed libraries and need to be&nbsp;reloaded.</p>
<div class="highlight"><pre><span></span>lsof -n <span class="p">|</span> grep ssl <span class="p">|</span> grep DEL
</pre></div>


<p>Find processes that need to be restarted after updating&nbsp;binaries.</p>
<div class="highlight"><pre><span></span>sudo lsof -d txt <span class="p">|</span> grep <span class="s1">&#39;(deleted)&#39;</span>
</pre></div>


<p>And now let&#8217;s get stared with the device&nbsp;files.</p>
<p>Find out what processes are using your&nbsp;webcam.</p>
<div class="highlight"><pre><span></span>lsof /dev/video0
</pre></div>


<p>Find out what processes are using your sound&nbsp;card.</p>
<div class="highlight"><pre><span></span>sudo lsof +D /dev/snd
</pre></div>


<p>The next one is one of my favorites. Displays all deleted files that are still open, and thus still occupy disk space, but are not part of any directory.
For example if you delete a big log file while it still opened by another&nbsp;process.</p>
<div class="highlight"><pre><span></span>lsof +L1
</pre></div>


<p>Now the definitive one. See how <code>lsof</code> can help you to recover a deleted&nbsp;file!</p>
<p>Imagie you deleted the <code>syslog</code> file accidentaly. As we said before, you can see some metadata from the deleted file using <code>lsof</code>.
Using the process (<code>PID</code>), and the file descriptor (<code>FD</code>) identifiers you can recover the&nbsp;file:</p>
<div class="highlight"><pre><span></span>COMMAND    PID       USER   FD   TYPE DEVICE SIZE/OFF NLINK    NODE NAME
insync    <span class="m">2432</span> frommelmak   30u   REG    <span class="m">8</span>,1     <span class="m">9252</span>     <span class="m">0</span> <span class="m">4326104</span> /var/tmp/etilqs_KFgJC2dGc3A3p9r <span class="o">(</span>deleted<span class="o">)</span>
soffice.b <span class="m">3377</span> frommelmak   23u   REG    <span class="m">8</span>,1     <span class="m">4096</span>     <span class="m">0</span>  <span class="m">789414</span> /home/frommelmak/.execoooAMcD6a <span class="o">(</span>deleted<span class="o">)</span>
syslog-ng <span class="m">1046</span> root         10w   REG    <span class="m">8</span>,1     <span class="m">278428</span>   <span class="m">0</span>   <span class="m">20198</span> /var/log/syslog <span class="o">(</span>deleted<span class="o">)</span>
</pre></div>


<p>Now you can recover the file as&nbsp;follows:</p>
<div class="highlight"><pre><span></span>cat /proc/1046/fd/10 &gt; /var/log/syslog
</pre></div>


<p>If you really want to release the space used by the syslog file without restart the <code>syslog</code> process, you can do something like&nbsp;this:</p>
<div class="highlight"><pre><span></span>&gt; /var/log/syslog
</pre></div>


<p>Or&nbsp;just:</p>
<div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;&quot;</span> &gt; /var/log/syslog
</pre></div>


<p>Finally you can put the <code>lsof</code> command in a repeat mode using <code>-|+r</code>. The prefix <code>-</code> puts the lsof in endless mode. You need to send a control signal to exit.
With the <code>+</code> prefix, <code>lsof</code> ends when there&#8217;s no output for the given&nbsp;parameters.</p>
<p>This article just cover the basics about <code>lsof</code>. For a complete list of features <span class="caps">RTFM</span>!</p>
  </div>


    <div class="comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'frommelmak';
        var disqus_identifier = "lsof-practical-usage-examples.html";
        var disqus_title = "lsof: Practical usage examples";
        var disqus_url = "https://frommelmak.com/lsof-practical-usage-examples.html";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.</noscript>
    </div>

        </div>

          <div class="col-md-3">
  <div class="well">

    <p><abbr title="2014-06-03T19:53:00+02:00"><i class="fa fa-calendar"></i> Tue 03 June 2014</abbr></p>

      <p><address>
        <i class="fa fa-user"></i> By
          <a href="https://frommelmak.com/author/frommelmak.html" rel="author">frommelmak</a>
      </address></p>

    <hr/>

      <p>
              <a href="https://frommelmak.com/category/english.html" rel="tag"
                  data-toggle="tooltip" class="label label-info"
                  title="15 articles in this category">English</a>
            <a href="/tag/lsof.html" data-toggle="tooltip"
      class="label label-default"
      title="1 article with this tag">lsof</a>
            <a href="/tag/sysadmin.html" data-toggle="tooltip"
      class="label label-default"
      title="1 article with this tag">sysadmin</a>
            <a href="/tag/tools.html" data-toggle="tooltip"
      class="label label-default"
      title="1 article with this tag">tools</a>
      </p>
      <hr/>

      <p>Found a typo ? Want to fix it ?</p>
      <a class="btn btn-info btn-block" href="https://github.com/frommelmak/blog/edit/master/content/posts/lsof-practical-usage-examples.md"><i class="fa fa-random fa-white fa-fw"></i> Edit article on GitHub</a>
      <hr/>

      <nav>
        <ul class="pager">
          <li class="previous ">
            <a  href="https://frommelmak.com/how-to-add-puppet-syntax-highlighting-to-dokuwiki.html" title="How to add Puppet syntax highlighting to Dokuwiki"  rel="prev">
              <span aria-hidden="true">←</span> Older
            </a>
          </li>
          <li class="next ">
            <a  href="https://frommelmak.com/utilizar-certificados-ssl-en-amazon-elb.html" title="Utilizar certificados SSL en Amazon ELB"  rel="next">
              Newer <span aria-hidden="true">→</span>
            </a>
          </li>
        </ul>
      </nav>

  </div>
            
          </div>

      </div>

    </div>

    <!-- TODO: make footer sticky -->
    <footer class="container-fluid">
      <div class="container">
        <div class="row">

            <div class="col-md-2">
                <h5>Social</h5>
                <ul class="list-unstyled">
                  <li>  <a href="http://twitter.com/frommelmak">
      <i class="fa fa-twitter"></i>
    @frommelmak
  </a></li>
                </ul>
            </div>
            <div class="col-md-2">
                <h5>Links</h5>
                <ul class="list-unstyled">
                  <li>  <a href="http://linkedin.com/in/marcosmartinezjimenez">
      <i class="fa fa-linkedin-square"></i>
    LinkedIn
  </a></li>
                  <li>  <a href="http://github.com/frommelmak">
      <i class="fa fa-github"></i>
    GitHub
  </a></li>
                  <li>  <a href="http://www.youtube.com/user/melmak">
      <img src="https://besticon-demo.herokuapp.com/icon?url=www.youtube.com&size=16" width="16" height="16" class="icon" alt="www.youtube.com icon"/>
    Youtube
  </a></li>
                </ul>
            </div>

          <div class="col-md-2">
            <h5>Browse content by</h5>
            <ul class="list-unstyled">
                <li><a href="https://frommelmak.com/categories/index.html"><i class="fa fa-tags"></i> Categories</a></li>
                <li><a href="https://frommelmak.com/archives/index.html"><i class="fa fa-calendar"></i> Dates</a></li>
                <li><a href="https://frommelmak.com/tags/index.html"><i class="fa fa-tag"></i> Tags</a></li>
            </ul>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Copyright notice</h5>
            <p>© Copyright 2005-2020 Marcos Martinez.</p>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Disclaimer</h5>
              <p>All opinions expressed in this site are my own personal opinions and are not endorsed by, nor do they represent the opinions of my previous, current and future employers or any of its affiliates, partners or customers.</p>
          </div>

          <div class="col-md-2">
          </div>

        </div>
      </div>

      <h5 class="text-right"><a href="#"><i class="fa fa-arrow-up"></i> Back to top</a></h5>

      <div class="container">
        <div class="row col-md-12 text-muted text-center">
          Site generated by <a href="https://getpelican.com"> Pelican</a>.<br/>
          <a href="https://github.com/kdeldycke/plumage"> Plumage</a> theme by <a href="https://kevin.deldycke.com">Kevin Deldycke</a>.
        </div>
      </div>

    </footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="https://frommelmak.com/theme/js/jquery.mglass.js"></script>
    <script src="https://frommelmak.com/theme/js/application.js"></script>

  </body>
</html>